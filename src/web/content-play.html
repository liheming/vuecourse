<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml" xmlns:v-on="http://www.w3.org/1999/xhtml"
      xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1,maximum-scale=1, minimum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!--标准mui.css-->
    <link rel="stylesheet" href="css/mui.min.css">
    <link rel="stylesheet" type="text/css" href="css/iconfont.css?_20180207"/>
    <link rel="stylesheet" type="text/css" href="css/app.css?_20180208"/>
    <style>


        video::-internal-media-controls-download-button {
            /*display: none!important;
				  	-webkit-appearance: none;*/
            display: none;
        }

        video::-webkit-media-controls-enclosure {
            overflow: hidden;
        }

        video::-webkit-media-controls-panel {
            width: calc(100% + 30px);
            /*display: none!important;
  					-webkit-appearance: none;*/
        }

        /* Old shadow dom for play button */
        video::--webkit-media-controls-play-button {
            display: none !important;
            -webkit-appearance: none;
        }

        /* New shadow dom for play button */
        /* This one works */
        video::-webkit-media-controls-start-playback-button {
            display: none !important;
            -webkit-appearance: none;
        }

        .mui-table-view-cell:after {
            background-color: #EBEBEB;
        }

        /*.main{*/
        /*position:fixed;top:50px; bottom:50px;overflow:scroll;*/
        /*}*/

        html {
            height: 100%;
        }

        body {
            min-height: 100%;
            margin: 0;
            padding: 0;
            position: relative;
        }

        .main {
            padding-bottom: 60px;
        }

        /*main的padding-bottom值要等于或大于footer的height值*/
        .footer {
            position: fixed;
            z-index: 10;
            right: 0;
            left: 0;
            /*position: absolute;*/
            bottom: 0;
            width: 100%;
            height: 50px;
        }

        /* 可以设置不同的进入和离开动画 */
        /* 设置持续时间和动画函数 */
        .slide-fade-enter-active {
            transition: all 1s ease;
        }

        .slide-fade-leave-active {
            transition: all 1s cubic-bezier(1.0, 0.5, 0.8, 1.0);
        }

        .slide-fade-enter, .slide-fade-leave-to
            /* .slide-fade-leave-active for below version 2.1.8 */
        {
            transform: translateX(30px);
            opacity: 0.8;
        }

        .item-li {

            border-radius: 5px;
            box-shadow: 0 0 8px 0 rgba(40, 40, 40, 0.2);
        }

        .mui-checkbox input[type=checkbox]:checked:before, .mui-radio input[type=radio]:checked:before {
            color: #f35b75;
        }
    </style>

</head>
<body style="background-color: white">

<div id="app" class="main">


    <template v-if="!content.isFree  &&  !content.hasBuy  ">
        <nav class="mui-bar mui-bar-tab"
             style=" background-color: #f35b75 ;  box-shadow: 0 -2px 0 rgba(194, 194, 194,0.2);">

            <div style="width: 100%; height: 51px;  float: left">
                <div
                        style="width: 40%  ;   float: left ;height: 51px;background-color: white ; text-align: center">

                    <div @click="openHomePage" style="width: 50%; height: 100%;  float: left ; padding-left: 20px">

                        <span><img
                                src="images/index-home.png"
                                style=" width: 28px ; height: auto ;padding-top: 6px"></span>
                        <div class="" style="color: #a89e9d ; font-size: 11px;margin-top: -4px;  ">首页
                        </div>
                    </div>

                    <div @click="openHelp"
                         style="width: 50%; height: 100%;  float: left ; text-align: left ;padding-left: 20px" class="">

                        <span><img
                                src="images/help.png"
                                style=" width: 28px ; height: auto ;padding-top: 6px"></span>
                        <div class="" style="color: #a89e9d ; font-size: 11px;margin-top: -4px; padding-left: 2px">帮助
                        </div>
                    </div>
                </div>

                <div @click="subCourse" style="float: left; width: 60%;  text-align: center; ">
                    <div style="color: white;font-size: 20px ;margin-top: 15px ;">立即订阅</div>
                </div>


            </div>
        </nav>


    </template>


    <template v-else>

        <nav v-if="isComment" id="commentLayout" class="footer"
             style="background-color: white ; box-shadow: 0 -2px 0 rgba(194, 194, 194,0.2);">
            <div style="padding-left: 10px; width: 100% ;height: 50px ;padding-top: 5px;    display: table;">
                <input id="inputcomment" type="text" v-model="message" placeholder="控制在100字以内喔"
                       style="font-size: 15px ; border: 0; width: 75%; color: #282828; padding: 5px 10px; background:#EEE; border-radius: 18px; margin-bottom: 0px;"/>
                <input id="inputbutton" type="button" value="发表"
                       style="font-size: 15px ; width: 20%; text-align: center; color: white; background:#f35b75; border-radius: 18px ; border: 0; padding: 9px 25px; margin-left: 5px;"
                       @click="addComments(content.id, content.type)"/>
            </div>
        </nav>

        <nav v-else class="mui-bar mui-bar-tab"
             style=" background-color: #f35b75 ;  box-shadow: 0 -2px 0 rgba(194, 194, 194,0.2);">

            <!--<div style="width: 100%; height: 51px;  float: left">-->
            <!--<div  style="width: 30%  ;  float: left ;background-color: white ; ">-->

            <!--<div @click="openHomePage" style="padding: 0 50px ;   width: 100%; height: 100%; " class="mui-tab-item">-->
            <!--&lt;!&ndash;<span class="mui-icon iconfont icon-home"></span>&ndash;&gt;-->
            <!--<span class="mui-icon   " style=" margin: 4px 4px 2px 0 "><img-->
            <!--src="images/index-home.png"-->
            <!--style=" width: 28px ; height: auto"></span>-->
            <!--<span class="mui-tab-label" style="color: #a89e9d">首页</span>-->
            <!--</div>-->
            <!--</div>-->

            <div style="width: 100%; height: 51px;  float: left">
                <div style="width: 40%  ;   float: left ;height: 51px;background-color: white ; text-align: center">

                    <div @click="openHomePage" style="width: 50%; height: 100%;  float: left ; padding-left: 20px">

                        <span><img
                                src="images/index-home.png"
                                style=" width: 28px ; height: auto ;padding-top: 6px"></span>
                        <div class="" style="color: #a89e9d ; font-size: 11px;margin-top: -4px;  ">首页
                        </div>
                    </div>

                    <div @click="openHelp"
                         style="width: 50%; height: 100%;  float: left ; text-align: left ;padding-left: 20px" class="">

                        <span><img
                                src="images/help.png"
                                style=" width: 28px ; height: auto ;padding-top: 6px"></span>
                        <div class="" style="color: #a89e9d ; font-size: 11px;margin-top: -4px; padding-left: 2px">帮助
                        </div>
                    </div>
                </div>


                <div @click="openHomePage(3)" style="float: left; width: 60%;  text-align: center; ">
                    <div style="color: white;font-size: 20px ;margin-top: 15px ;">更多推荐</div>
                </div>
            </div>
        </nav>


    </template>


    <template v-if="isSeen">


        <div class="mui-content main" style="padding-bottom: 0 ;">

            <div onclick="doCollect()"
                 style="  z-index: 6;  position:fixed; top:75px; right:1px;  background:rgba(243,91,117,1); border-bottom-left-radius:50px;border-top-left-radius:50px;  padding: 5px 10px; ">
                <div style="float: left ; padding-top: 5px ; ">

                    <img v-if="content.isRemark" src="images/play-like-ok.png"
                         style="width: 18px ; height: 18px">
                    <img v-else src="images/play-like.png" style="width: 18px ; height: 18px ; ">
                </div>
                <transition name="slide-fade">
                    <template v-if="remarkNumIsShow">
                        <div id="collectNum" style="color: white ;float: left ; font-size: 14px ; padding-top: 3px">
                            &nbsp;{{
                            content.remarkNum > 9999 ? Math.round(content.remarkNum/10000*100)/100 + '万' :
                            content.remarkNum }}人收藏
                        </div>
                    </template>
                </transition>
            </div>

            <transition name="slide-fade">
                <template v-if="backTopIsShow">
                    <div onclick="backTop()"
                         style="  z-index: 6;  position:fixed; bottom:100px; right:1px;  background:rgba(0,0,0,0.4); border-bottom-left-radius:50px;border-top-left-radius:50px;  padding: 5px 10px; ">
                        <div style="float: left ; padding-top: 2px ; ">

                            <img src="images/backTop.png"
                                 style="width: 18px ; height: 18px">
                        </div>

                    </div>
                </template>
            </transition>


            <div style="background-color: white ;">
                <div style="position: relative ; background-color: white; height: 100%; width: 100%;">

                    <video id="myVideo" v-bind:src="fileUrl"
                           onplay="videoPlay()"  playsinline=""  webkit-playsinline=""
                           preload="auto" style="width: 100%  ;height: auto"  :poster="content.topPicture"
                           v-bind:title="subsetName">
                    </video>
                    <!--<div  v-bind:style="{ background-image: url(content.topPicture) ,position: absolute , top: -5px}"></div>-->
                    <!--<img v-if="playIsShow" :src="content.topPicture"  v-bind:style="{  width: '100%' , height: 'inherit' ,  position: 'absolute' , top: '0' ,fontSize : content.topPicture, color : 'red'}" >-->
                    <div v-if="playIsShow" @click="playVideo(fileUrl)"
                         style="width: 100% ; height: inherit ; position: absolute; top: -5.5px ; background:rgba(40,40,40,0.3);  ">
                        <div style="position:   absolute;top: 50%;  left:35% ;   transform: translateY(-50%); color: white ;  ">
                            <img src="images/icon-play.png" style="height: 43px ; width: auto">
                        </div>
                    </div>


                </div>

                <div style="padding: 20px ;position: relative ; ">

                    <p style="color: #282828;  overflow: hidden; font-size: 15px; font-weight: bold">
                        {{ content.contentName }}
                        <!--{{ subsetName }}目录中第几集的名字 -->
                    </p>
                    <p class='mui-ellipsis' style="font-size: 13px;"> {{ content.director }} </p>

                    <div class='mui-ellipsis' style="width: 100%;">
                        <p style="display: inline; font-size: 11px;">
                            已有{{content.playNum}}人播放
                        </p>

                        <div style="display: inline; float: right;">
                            <span style="font-size: 11px ; color: #a89e9d;  text-decoration:line-through">{{content.isFree ?  '' : '原价¥'}} {{content.isFree ?  '' : content.price+30}}</span>
                            <span style="font-size: 15px ; color:  #f35b75 "> {{content.isFree ? '免费' : '¥'+content.price+'' }}</span>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </template>


    <div style="height: 5px ; width: 100% ;background-color: #f9faff"></div>

    <div style="padding-top: 5px ;    background-color: white ; " class="content-div">

        <div class="mui-segmented-control" style="padding: 3px 0 ;      z-index: 5; font-size: 15px">
            <a id="detail" class="mui-control-item mui-active" href="#item-detail"
               style=" font-size: 15px  ">简介<span></span></a>
            <a id="category" class="mui-control-item " href="#item-category"
               style=" font-size: 15px ">目录<span></span></a>
            <a id="comment" class="mui-control-item" href="#item-comment"
               style=" font-size: 15px ;">评论<span></span></a>


        </div>

        <div style="height: 2px ; width: 100% ;background-color: #f9faff"></div>

        <div id="item-detail" class="mui-control-content mui-active">

            <div class="pic-detail" style="   overflow: hidden;">
                <div v-for="image in content.contentPicture">
                    <img v-bind:src="image" style="width: 100%; ">

                </div>


            </div>

            <img src="images/showAllDetail.png" class="showAll" onclick="showAllContent()"
                 style="  width:  100% ;   margin-top: -200px ">
            <div>
                <img src="images/use-guide.jpg" style="width: 100% ; ">

            </div>

            <div style="height: 5px ; width: 100% ;background-color: #f9faff"></div>


            <template v-if="newRecisShow">
                <div class="mostNewRecommend">
                    <div style="padding: 20px  0  10px  15px ;font-size: 17px ; color: #282828 ;font-weight: bold ">
                        同类推荐
                    </div>


                    <div class="list">

                        <ul class="mui-table-view">
                            <li v-for=" (item, index) in newRecommendData" v-if="index<3"
                                class="mui-table-view-cell mui-media"
                                style=" height: 100%">
                                <a class="item-a" @click="getContent(item.id)">

                                    <div class="item-div-img">
                                        <img class="item-preview-img"
                                             v-bind:src="  item.preview ==''  ?   'images/default-preview.jpg' : item.preview   ">
                                    </div>
                                    <div class="item-content-div">
                                        <div class="item-content-div-div">
                                            <p class=" item-contentName">{{item.contentName}} </p>
                                            <p class="item-totalNum-num">共{{item.totalNum}}集 | 已更{{item.hasNum}}集</p>
                                            <p class="item-playNum"> {{item.playNum > 9999 ?
                                                Math.round(item.playNum/10000*100)/100 +'万人在学' :item.playNum+'人在学'
                                                }}</p>
                                            <div class="item-content-div-div-div">
                                                <p>
                                                    <span class="item-base-price">{{item.isFree ?  '' : '原价¥'}} {{item.isFree ?  '' : item.price+30}}</span>
                                                    <span class="item-price"> {{item.isFree ? '免费' : '¥'+item.price+'' }}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </li>

                        </ul>
                    </div>

                </div>
            </template>


        </div>


        <div id="item-category" class="mui-control-content ">

            <div class="category-collection">
                <ul class="mui-table-view mui-table-view-chevron">

                    <li v-bind:style="{ color:   (content.isFree  || content.hasBuy || item.isTry==1)  && index==myindex ?  '#f35b75' :  '#282828'  }"
                        v-for="  (item, index)  in   categoryData" class="mui-table-view-cell">
                        <a style="padding:15px 30px 15px 20px"
                           @click="changeVideo(item.fileUrl, item.subsetName, item.id, item.isTry,item.productsType, content.isFree,content.hasBuy)">
                            <template v-if="!content.isFree &&  !content.hasBuy">

                                <img v-if="item.isTry" src="images/icon-free.png" style="width: 16px;">
                                <img v-else src="images/icon-money.jpg" style="width: 16px;">

                            </template>

                            <span style="font-size: 15px ; "> {{item.subsetName}} </span>
                            <!--<span v-if="item.isTry" style="position: absolute;right: 25px ; font-size: 11px ; color: white; margin-top: 2px ; background:#f35b75;  display: inline-block; border-radius: 5px;border: 1px solid #f35b75;  padding: 1px 3px; ">{{ item.isTry==1 ?  '试看' :  '' }} </span>-->
                        </a>
                    </li>


                </ul>
            </div>


            <div style="height: 5px ; width: 100% ;background-color: #f9faff"></div>


            <template v-if="">
                <div class="lastUpdate">
                    <div style="padding: 20px  0  10px  15px ;font-size: 17px ; color: #282828 ;font-weight: bold ">
                        最近更新
                    </div>

                    <div class="list">

                        <ul class="mui-table-view">
                            <li v-for=" (item, index) in recentUpdate" v-if="index<3"
                                class="mui-table-view-cell mui-media"
                                style=" height: 100%">
                                <a class="item-a" @click="getContent(item.productid)">

                                    <div class="item-div-img">
                                        <img class="item-preview-img"
                                             v-bind:src="  item.preview ==''  ?   'images/default-preview.jpg' : item.preview   ">
                                    </div>
                                    <div class="item-content-div">
                                        <div class="item-content-div-div">
                                            <p class=" item-contentName">{{item.productName}} </p>
                                            <p class="item-totalNum-num">更新时间：{{item.updateTime}}</p>
                                            <p class="item-playNum"> {{item.contentName }}</p>
                                        </div>
                                    </div>
                                </a>
                            </li>

                        </ul>
                    </div>

                </div>
            </template>
        </div>


        <div id="item-comment" class="mui-control-content ">

            <template v-if="commentIsShow">

                <!--精彩评论-->
                <div v-if="goodComment" class="goodComment">
                    <ul v-if="topcommentData" class="mui-table-view">
                        <div style="padding: 15px 0 15px 20px  ;font-size: 15px">精彩评论
                        </div>
                        <li v-for=" (item, index) in topcommentData " style=" padding-top: 10px">

                            <div style=" float: left;width: 100%;  padding-left: 20px ;  padding-right: 20px ;  ">

                                <div>
                                    <img v-if="!(item.headPic == '' || item.headPic == null)" v-bind:src="item.headPic"
                                         style=" width: 30px ;  height: 30px; float: left">
                                </div>
                                <div style="padding-left: 10px ; margin-top: 2px; float: left;  line-height: 9px">
                                    <p style="font-size: 13px ;font-weight: bold;color: black;">{{item.userName}}<img
                                            src="images/top-tips.png" style="height: 15px ; padding-left: 3px;"></p>
                                    <p style="font-size: 11px">{{ item.commentTime }}</p>
                                </div>
                                <div @click="likeComment(item.id,index)" style="text-align: right">

                                    <span v-if="item.isLike" class="mui-icon iconfont icon-like"
                                          style=" font-size:  14px  ;color: red"></span>

                                    <span v-else class="mui-icon iconfont icon-un-like"
                                          style=" font-size:  14px"></span>

                                    <span style="color: #8f8f94"> {{  item.likeNum > 9999 ?  Math.round(item.likeNum/10000*100)/100 + '万'  :  item.likeNum  }}  </span>
                                </div>
                            </div>

                            <div style=" padding-left: 60px ; font-size: 14px ;padding-bottom: 10px ; padding-right: 35px ; ">
                                {{item.comment}}
                            </div>

                            <template v-if="!(item.reply == '' || item.reply == null)">
                                <div style="font-size: 14px;   background-color: #f9faff ;        padding: 10px 35px 10px 60px;">
                                    <span style="color: #f35b75;font-size: 14px;">|三到云课堂小助手</span>
                                    回复：{{item.reply}}
                                </div>
                            </template>


                            <div style="height: 1px ; width: 100% ;background-color: #f9faff"></div>
                        </li>

                    </ul>
                </div>


                <div style="height: 5px ; width: 100% ;background-color: #f9faff"></div>
                <!--<div style="height: 5px ; width: 100% ;background-color: #f9faff"></div>-->
                <!--所有评论 -->
                <div class="allComment">
                    <div style="padding: 15px 0 15px 20px  ;font-size: 15px">所有评论 <span style="color:#f35b75 "> ({{commentData == null ?  '0' : commentData.length}}人) </span>
                    </div>
                    <ul class="mui-table-view">
                        <li v-for=" (item, index) in commentData " style=" padding-top: 10px">

                            <div style=" float: left;width: 100%;  padding-left: 20px ;  padding-right:20px ;  ">

                                <div>
                                    <img v-if="!(item.headPic == '' || item.headPic == null)" v-bind:src="item.headPic"
                                         style=" width: 30px ;  height: 30px; float: left">
                                </div>
                                <div style="padding-left: 10px ; margin-top: 2px; float: left;  line-height: 9px">
                                    <p style="font-size: 13px ;font-weight: bold;color: black;">{{item.userName}}</p>
                                    <p style="font-size: 11px">{{ item.commentTime }}</p>
                                </div>
                                <div @click="likeComment(item.id,index)" style="text-align: right">

                                    <span v-if="item.isLike" class="mui-icon iconfont icon-like"
                                          style=" font-size:  14px  ;color: red"></span>

                                    <span v-else class="mui-icon iconfont icon-un-like"
                                          style=" font-size:  14px"></span>

                                    <span style="color: #8f8f94"> {{  item.likeNum > 9999 ?  Math.round(item.likeNum/10000*100)/100 + '万'  :  item.likeNum  }}  </span>
                                </div>
                            </div>

                            <div style=" padding-left: 60px ; font-size: 14px ;padding-bottom: 10px ; padding-right: 35px ; ">
                                {{item.comment}}
                            </div>

                            <template v-if="!(item.reply == '' || item.reply == null)">
                                <div style="font-size: 14px;   background-color: #f9faff ;        padding: 10px 35px 10px 60px;">
                                    <span style="color: #f35b75;font-size: 14px;">|三到云课堂小助手</span>
                                    回复：{{item.reply}}
                                </div>
                            </template>

                            <div style="height: 1px ; width: 100% ;background-color: #f9faff"></div>
                        </li>
                    </ul>
                </div>


                <div style="height: 5px ; width: 100% ;background-color: #f9faff"></div>
                <div class="courseHotComment">

                    <ul v-if="recommendcommentData" class="mui-table-view">
                        <div style="padding: 15px 0 15px 20px  ;font-size: 15px">课程热评
                        </div>
                        <li class="item-li" v-for=" (item, index) in recommendcommentData "
                            @click="getContent(item.productsId)"
                            style=" padding-top: 10px ;margin: 0 20px">
                            <div style=" float: left;width: 100%;  padding: 0 10px  ">

                                <div>
                                    <img v-if="!(item.headPic == '' || item.headPic == null)" v-bind:src="item.headPic"
                                         style=" width: 30px ;  height: 30px; float: left">
                                </div>
                                <div style="padding-left: 10px ; margin-top: 2px; float: left;  line-height: 9px">
                                    <p style="font-size: 13px ;font-weight: bold;color: black;">{{item.userName}}</p>
                                    <p style="font-size: 11px">{{ item.commentTime }}</p>
                                </div>
                                <div @click="likeComment(item.id,index)" style="text-align: right">

                                    <span v-if="item.isLike" class="mui-icon iconfont icon-like"
                                          style=" font-size:  14px  ;color: red"></span>

                                    <span v-else class="mui-icon iconfont icon-un-like"
                                          style=" font-size:  14px"></span>

                                    <span style="color: #8f8f94"> {{  item.likeNum > 9999 ?  Math.round(item.likeNum/10000*100)/100 + '万'  :  item.likeNum  }}  </span>
                                </div>
                            </div>

                            <div style=" padding-left: 60px ; font-size: 14px ;padding-bottom: 10px ; padding-right: 35px ; ">
                                {{item.comment}}
                            </div>

                            <div style="width: 100%;  height: 100% ; padding: 0 10px">
                                <div class="item-div-img">
                                    <img class="item-preview-img"
                                         v-bind:src="  item.preview ==''  ?   'images/default-preview.jpg' : item.preview   ">
                                </div>
                                <div class="item-content-div">
                                    <div style=" display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
    white-space: normal;
    width: 65%;
    margin-right: 0;
    padding-left: 10px;
    font-size: 15px;
    line-height: 20px;">
                                        <p class=" item-contentName">{{item.productsName}} </p>
                                        <p class=" item-totalNum-num" style="font-size: 12px ; margin-top: -5px">
                                            {{item.subhead}} </p>
                                    </div>
                                </div>

                            </div>

                            <div style="height: 1px ; width: 100% ;background-color: #f9faff"></div>
                        </li>
                    </ul>


                </div>

            </template>


            <template v-else>
                <div style="width: 100%;height: 100%;background-color: white;text-align: center;">
                    <div style="padding-top: 50%;">
                        <img style="width: 35%;  " src="images/ic_comment_not.png"/>
                    </div>
                    <div style="margin-top: 4%;">
                        <p style="font-size: 11px;">暂无评论喔~</p>
                    </div>
                </div>
            </template>

            <!--<div style="background-color: white ; font-size: 8px ; color: darkgray; width: 100% ; text-align: center; padding: 15px">-->

            <!--<span>已经加载完</span>-->
            <!--</div>-->

        </div>


    </div>


    <template v-if="dialogShow">
        <div v-if="dialogType == 'sub' " id="sub" class="mui-popup mui-popup-in"
             style="display: block; line-height: 35px; width: 350px">
            <div class="mui-popup-inner">
                <div class="mui-popup-title" style="margin-top: 5px">《{{content.title}}》课程</div>

                <!--<div>-->
                <!--<span style="font-size: 11px ; color: #8f8f94;  text-decoration:line-through">{{content.isFree ?  '' : '原价¥'}} {{content.isFree ?  '' : content.price+30}}</span>-->
                <!--<span style="font-size: 15px ; color:  red "> {{content.isFree ? '免费' : '¥'+content.price+'' }}</span>-->

                <!--</div>-->

                <button @click="wxPayConfig(content.productsCode)" class="mui-ellipsis"
                        value="" type="button"
                        style="font-size: 20px ; margin-top: 20px;       border: 0;  color: white; background:#f35b75; display: inline-block; border-radius: 50px; padding: 12px 80px; ">
                    微信支付<span style="font-size: 12px">{{content.isFree ? '免费' : '¥'+content.price+'' }}</span></button>
                <div v-if="content.supportCalls" style="text-align: center">
                    <button @click="huafeiPay(0)" class="mui-ellipsis"
                            value="" type="button"
                            style="font-size: 20px ;  margin-top: 15px;    border: 0;  color: white; background:#f35b75; display: inline-block; border-radius: 50px; padding: 12px 70px; ">
                        话费支付<span style="font-size: 12px" v-text=" '¥'+content.callsPrice+'/月'"></span></button>
                    <div style="text-align: center ; padding: 0 50px ;margin-top: 5px">
                        <div class=" mui-checkbox mui-left">
                            <input name="checkbox" class="check-input" type="checkbox">
                        </div>
                        <div @click="openProtocol"
                             style="text-align: center ; z-index: 5; padding-left: 20px; font-size: 14px; color: sandybrown;  text-decoration:  underline ; ">
                            话费支付服务使用协议
                        </div>
                        <!--<div class=" mui-checkbox ">-->
                        <!--<input name="radio" value="Item 1" type="checkbox" style="color: yellow ; ">-->
                        <!--</div>-->

                    </div>
                </div>
                <div class="mui-popup-out"><span class="mui-icon iconfont icon-close"
                                                 style="position: absolute; right: 6px ; top: 6px; font-size: 20px;"
                                                 @click="closeDialog"></span></div>
            </div>
        </div>


        <div v-else-if=" dialogType == 'subSuccess' " class="mui-popup mui-popup-in"
             style="display: block; font-size: 16px; line-height: 40px; width: 320px; ">
            <div class="mui-popup-inner" style="padding: 40px">
                <div class="mui-popup-title">恭喜你已经成功订阅</div>
                <div class="mui-popup-text">《{{content.contentName}}》课程</div>
                <input @click="closeDialog" class="mui-ellipsis" value="我知道了" type="button"
                       style="font-size: 20px ; border: 0; margin-top: 15px; color: white; background:#f35b75; display: inline-block; border-radius: 50px; padding: 10px 70px; "/>
                <div class="mui-popup-out"><span class="mui-icon iconfont icon-close"
                                                 style="position: absolute; right: 2px ; top: 2px;"
                                                 @click="closeDialog"></span></div>
            </div>
        </div>

        <!--短信协议-->
        <div v-else-if=" dialogType == 'smsProtocol' " class="mui-popup mui-popup-in"
             style="display: block; font-size: 14px; line-height: 22px; width:90%; ">
            <div class="mui-popup-inner" style="padding: 20px">

                <div class="mui-popup-title">话费支付服务使用协议</div>
                <div>
                    <div style="color: #8f8f94">
                        <ul style="padding-left: 0;text-align: left ; text-decoration: none;list-style: none">

                            <li><img src="images/sms-rule-dot.png" style="width: 8px"><span style="padding-left: 10px">三到云课堂为您提供“亲子母婴10元包”系列连续包月课程服务，资费为￥10.00元/月，开通后当天生效，在您退订前可观看本系列课程已上架的所有内容。</span>
                            </li>
                            <li><img src="images/sms-rule-dot.png" style="width: 8px"><span style="padding-left: 10px">以话费开通后立即生效，按自然月为用户提供包月收费，如不退订则每月自动续订（每月月初自动续费），您话单显示的业务名称为“亲子母婴10元包”。</span>
                            </li>
                            <li><img src="images/sms-rule-dot.png" style="width: 8px"><span style="padding-left: 10px">本业务目前支持中国联通用户使用，开通的省份为：内蒙古、宁夏、山东、山西、天津、北京、河北、贵州、辽宁、广西、海南、湖南（仅限4G用户）、福建、陕西、浙江、黑龙江、江西、安徽、重庆，其余省份陆续开通中，敬请期待。</span>
                            </li>
                            <li><img src="images/sms-rule-dot.png" style="width: 8px"><span style="padding-left: 10px">本次支付仅限于“郑渊洁安全百科”系列课程，不包括三到云课堂内其他系列课程。本业务支持随时退订，您可拨打10010号客服热线或三到云课堂客服热线退订，即可取消连续包月业务，次月生效不再扣费，</span>
                            </li>
                            <li><img src="images/sms-rule-dot.png" style="width: 8px"><span style="padding-left: 10px">三到云课堂承诺获得版权内容代理授权，承担相应的法律责任，如内容当中包含不良信息，请积极向客服热线进行反馈。</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <input @click="huafeiPay(1)" class="mui-ellipsis" value="继续支付" type="button"
                       style="font-size: 20px ; border: 0; margin-top: 15px; color: white; background:#f35b75; display: inline-block; border-radius: 50px; padding: 10px 70px; "/>
                <div class="mui-popup-out"><span class="mui-icon iconfont icon-close"
                                                 style="position: absolute; right: 6px ; top: 6px; font-size: 20px;"
                                                 @click="closeDialog"></span></div>
            </div>
        </div>


        <div v-else-if=" dialogType == 'subFail' " id="subfail" class="mui-popup mui-popup-in"
             style="display: block; font-size: 16px; line-height: 40px; width: 320px; ">
            <div class="mui-popup-inner" style="padding: 30px">
                <div class="mui-popup-title">订阅未成功</div>

                <div v-if="content.supportCalls">
                    <input @click="changeOtherPay" class="mui-ellipsis" value="换一种支付方式"
                           type="button"
                           style="font-size: 20px ; border: 0; margin-top: 15px; color: white; background:#f35b75; display: inline-block; border-radius: 50px; padding: 10px 30px; "/>
                    <div style="padding-top: 15px ;color: #8f8f94"><label>查看详情>></label></div>
                </div>
                <div v-else>
                    <input @click="closeDialog" class="mui-ellipsis" value="我知道了" type="button"
                           style="font-size: 20px ; border: 0; margin-top: 15px; color: white; background:#f35b75; display: inline-block; border-radius: 50px; padding: 10px 70px; "/>
                </div>

                <div class="mui-popup-out"><span class="mui-icon iconfont icon-close"
                                                 style="position: absolute; right: 6px ; top: 6px; font-size: 20px;"
                                                 @click="closeDialog"></span></div>
            </div>
        </div>


        <div v-else-if=" dialogType == 'smsSub' " id="smsSub" class="mui-popup mui-popup-in"
             style="display: block; font-size: 16px; line-height: 40px; width: 380px; ">
            <div class="mui-popup-inner" style="padding: 30px">
                <div class="order-input">

                    <div class="">
                        <input class="" id="textPhone" minlength="11" type="tel"
                               placeholder="请输入手机号"
                               style=" padding: 10px  ; width: 100% ;border-radius: 5px ; ">
                    </div>
                    <div>
                        <input id="textSmCode" maxlength="8" type="tel" placeholder="请输入验证码"
                               style="width: 65% ;border-radius: 5px ; ">
                        <button onclick="checkPhone(this)" type="button"
                                style="border-radius: 5px ;width: 33%; padding: 10px; background-color: white ;color:  #f35b75 ; border: solid #f35b75 1px">
                            获取验证码
                        </button>
                    </div>

                    <div>
                        <button type="button" onclick="confirmVerifyCode()"
                                style=" border-radius: 90px ; background-color: #f35b75 ; color: white ; padding: 10px; font-size: 20px ; width: 78%;">
                            确定
                        </button>
                    </div>
                    <div class="mui-popup-out"><span class="mui-icon iconfont icon-close"
                                                     style="position: absolute; right: 6px ; top: 6px; font-size: 20px;"
                                                     @click="closeDialog"></span></div>

                </div>
            </div>
        </div>

        <div class="mui-popup-backdrop mui-active" style="display: block;"></div>

    </template>

</div>


<!--先引入库文件 再使用库文件  顺序不能乱-->
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<!--<script src="https://cdn.bootcss.com/babel-polyfill/6.23.0/polyfill.min.js"></script>-->
<script src="js/mui.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/api.js?ver=2018021217"></script>
<script src="js/base.js?ver=2018021217"></script>
<!--微信支付js-sdk-->
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>

<script>


    mui.init({
        swipeBack: false,//启用右滑关闭功能

        pullRefresh: {
            container: '#pullrefresh',
            down: {
                style: 'circle',//必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
                color: '#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
                height: '50px',//可选,默认50px.下拉刷新控件的高度,
                range: '100px', //可选 默认100px,控件可下拉拖拽的范围
                offset: '0px', //可选 默认0px,下拉刷新控件的起始位置
                auto: true,//可选,默认false.首次加载自动上拉刷新一次
                callback: pulldownRefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
            }

            ,
            up: {
                auto: true,
                contentrefresh: '正在加载...',
                callback: pullupRefresh
            }
        }
    });

    function videoPlay() {
        var myVideo = document.getElementById('myVideo');
        myVideo.controls = 'controls';
    };

    var count = 0;
    function pullupRefresh() {
        setTimeout(function () {
            mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
            var table = document.body.querySelector('.mui-table-view');
            var cells = document.body.querySelectorAll('.mui-table-view-cell');
            var newCount = cells.length > 0 ? 5 : 20;//首次加载20条，满屏
            for (var i = cells.length, len = i + newCount; i < len; i++) {
                var li = document.createElement('li');
                li.className = 'mui-table-view-cell';
                li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
                table.appendChild(li);
            }
        }, 1500);
    }

    function addData() {
        var table = document.body.querySelector('.mui-table-view');
        var cells = document.body.querySelectorAll('.mui-table-view-cell');
        for (var i = cells.length, len = i + 5; i < len; i++) {
            var li = document.createElement('li');
            li.className = 'mui-table-view-cell';
            li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
            //下拉刷新，新纪录插到最前面；
            table.insertBefore(li, table.firstChild);
        }
    }
    /**
     * 下拉刷新具体业务实现
     */
    function pulldownRefresh() {
        setTimeout(function () {
            addData();
            mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
            mui.toast("为你推荐了5篇文章");
        }, 1500);
    }


    var sum;
    var scHeight = window.screen.height - 44 - 51; //屏幕高度-顶部标题和底部tab
    $(".pic-detail").css('height', scHeight);
    $(".pic-detail").css('overflow', 'hidden');
    $(".content-div").css('min-height', scHeight + 35); //设置固定高度


    /**
     * 点击显示全文
     */
    function showAllContent() {

        $('.pic-detail').css('overflow', 'visible');
        $('.pic-detail').css('height', '100%');
        $('.showAll').remove();
    }

    /**
     * 返回顶部
     */
    function backTop() {

        vmplay.backTopIsShow = false;
        $('html, body').animate({scrollTop: 0}, 'fast');//带动画回到頂部
    }

    // 判断是否滑到底部
    $(document).ready(function () {

        /**
         * 菜单栏贴边顶部
         * */

        $(window).scroll(function () {

            var elToTop = $('.mui-segmented-control').offset().top;
            var gun = $(document).scrollTop();
            var top = elToTop - gun;

            if (top <= 0) {
                // 固定
                $('.mui-segmented-control').css('position', 'fixed');
                $('.mui-segmented-control').css('top', '0');
                $('.mui-segmented-control').css('z-index ', '10');
            }
            if ((sum - 44) > elToTop) {// 取消固定
                $('.mui-segmented-control').css('position', 'relative');
            }

            if ($(document).scrollTop() >= $(document).height() - $(window).height()) {

//                console.log("您已经到达底部了");
                vmplay.backTopIsShow = true;
            } else if ($(document).scrollTop() <= $(document).height() - $(window).height() - scHeight) {

//                console.log("已经划过一页了");
                vmplay.backTopIsShow = false;

            }


        });


    });


    setTimeout(" vmplay.remarkNumIsShow = false ;  ", 1500);//自动隐藏收藏

    //    sum = $('.mui-segmented-control').offset(); // 简介 目录 评论初始高度记录初始高度


    /**
     * 初始化
     */
    function initView() {

        sum = $('.mui-segmented-control').offset().top;
        var detail = document.getElementById('detail');
        var category = document.getElementById("category");
        var comment = document.getElementById("comment");
        detail.addEventListener('tap', function () {
            vmplay.isComment = false;
        });

        category.addEventListener('tap', function () {
            vmplay.isComment = false;
            getProductList(GetQueryString("id"));
            getRecentUpdate(productsid)
        });

        comment.addEventListener('tap', function () {
            vmplay.isComment = true;
            getComment(vmplay.content.id);
            getTopComment(vmplay.content.id);
            getRecommendComment(vmplay.content.id);
        });


//      addCollection(vmplay.content.contentId, vmplay.content.type);

        var contentId = GetQueryString("contentId");

        if (vmplay.categoryData['0'].contentName != null || vmplay.categoryData['0'].contentName != '') {
            document.title = vmplay.categoryData['0'].contentName;
        }
        if (contentId == '') {// 普通跳转的

            vmplay.fileUrl = vmplay.categoryData['0'].fileUrl;
            vmplay.subsetName = vmplay.categoryData['0'].subsetName;

            addPlayRecord(GetQueryString('id'), vmplay.categoryData['0'].productsType, vmplay.categoryData['0'].id);

        } else if (contentId == 'comment') {
            // 从评论页面跳转的
            vmplay.fileUrl = vmplay.categoryData['0'].fileUrl;
            vmplay.subsetName = vmplay.categoryData['0'].subsetName;

            getComment(vmplay.content.id);
            getTopComment(vmplay.content.id);
            getRecommendComment(vmplay.content.id);
            addPlayRecord(GetQueryString('id'), vmplay.categoryData['0'].productsType, vmplay.categoryData['0'].id);
            $("#detail").removeClass("mui-active");
            $("#item-detail").removeClass("mui-active");
            $("#comment").addClass("mui-active");
            $("#item-comment").addClass("mui-active");

        }

        else {
            // 从播放记录跳转的
            $("#detail").removeClass("mui-active");
            $("#item-detail").removeClass("mui-active");
            $("#category").addClass("mui-active");
            $("#item-category").addClass("mui-active");

            for (var i = 0; i < vmplay.categoryData.length; i++) {
                if (vmplay.categoryData[i].id == contentId) {
                    vmplay.myindex = i;
                    vmplay.fileUrl = vmplay.categoryData[i].fileUrl;
                    vmplay.subsetName = vmplay.categoryData[i].subsetName;
                    addPlayRecord(GetQueryString('id'), vmplay.categoryData[i].productsType, vmplay.categoryData[i].id);
                }
            }
        }

    }

    var vmplay = new Vue({
        el: '#app'
        ,
        data: {
            dialogShow: false,
            dialogType: '',
            backTopIsShow: false,
            remarkNumIsShow: true,
            goHome: false,
            playIsShow: true,
            agreeProtocol: 0,
            myindex: 0,
            message: '',
            commentIsShow: false,
            goodComment: false,  //精彩评论
            newRecisShow: false,
            isSeen: false,
            isComment: false,
            isCollect: true,
            fileUrl: null,
            subsetName: null,
            content: null,
            commentData: null,
            topcommentData: null,
            recommendcommentData: null,
            categoryData: null,
            recentUpdate: null,
            newRecommendData: null
        },

        watch: {
            message: {
                handler: function () {
                    if (this.message != '') {
                        $("#inputbutton").removeAttr("disabled");
                    }
                }
            }
        },
        methods: {

            tabDetail: function () {
                alert("正在升级，敬请期待");
            },


            tabCategory: function () {
                alert("正在升级，敬请期待");
            },


            share: function () {
                alert("正在升级，敬请期待");
            },

            playVideo: function (fileUrl) {
                if (!fileUrl) {
                    this.subCourse();
                } else {
                    $("#myVideo").trigger('play');
                    $("#myVideo").attr('autoplay', 'autoplay');
                    vmplay.playIsShow = false;
                    console.log();
                    //播放量
                    addCollection(vmplay.content.contentId, vmplay.content.type);
                }

            },

            sendFriend: function () {
                alert("正在升级，敬请期待");
            },

            subCourse: function () {
                this.dialogType = 'sub';
                this.dialogShow = true;

            },

            huafeiPay: function (ok) {
                if (ok) {
                    this.dialogType = 'sub';
                    this.dialogShow = true;
                    payType = FAREPAY;
                } else {
                    if ($("input[type='checkbox']").is(':checked')) {
                        this.dialogType = 'smsSub';
                        this.dialogShow = true;
                        payType = FAREPAY;
                    } else {
                        alert("请先同意话费使用协议");
                    }     //所有版本:true/false
                }


            },


            openProtocol: function () {
                this.dialogType = 'smsProtocol';
                this.dialogShow = true;


            },
            closeDialog: function () {
                this.dialogShow = false;

            },
            changeVideo: function (fileUrl, subsetName, contentId, isTry, productsType, isFree, hasBuy) {
                $("ul li").click(function () {

                    $("ul li").css({"color": " #282828"});
                    $(this).css({"color": " #f35b75"});
                });


                if (isFree || hasBuy || isTry) {
                    addPlayRecord(GetQueryString('id'), productsType, contentId);
                    this.subsetName = subsetName;
                    this.fileUrl = fileUrl;
                } else {
                    this.subsetName = subsetName;
                    this.fileUrl = fileUrl;
                    // 弹窗支付
                    this.dialogType = 'sub';
                    this.dialogShow = true;
                }

            }
        }
    });

    var productsid = GetQueryString("id");
    getRecommendList(productsid);
    getContent(productsid);

    /**
     * 点赞销售品的评论
     * @param productsid
     * @param index
     */
    function likeComment(commentsId, index) {

        $.ajax({
            url: hostUrl + 'comments/like/addLike',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'commentsid': commentsId,
                'userid': userid
            },
            dataType: 'json',
            success: function (result) {
//                console.log(result);
                if (result.code == 200) {
                    if (vmplay.commentData[index].isLike == 1) {
                        vmplay.commentData[index].likeNum--;
                        vmplay.commentData[index].isLike = 0
                    }
                    else {
                        vmplay.commentData[index].likeNum++;
                        vmplay.commentData[index].isLike = 1
                    }
                }
            },
            error: function () {

            }
        });
    }

    /**
     * 评论时间的转换
     * @param data
     */
    function computerDataTime(data) {
        for (j = 0; j < data.length; j++) {
            var item = data[j];

            var commentTime = item.commentTime;

            var date2 = new Date();//结束时间
            var date3 = date2.getTime() - new Date(commentTime).getTime();//时间差的毫秒数
            //计算出小时数
            var leave1 = date3 % (24 * 3600 * 1000);   //计算天数后剩余的毫秒数

            var days = Math.floor(date3 / (24 * 3600 * 1000));
            var hours = Math.floor(leave1 / (3600 * 1000));

            var leave2 = leave1 % (3600 * 1000);        //计算小时数后剩余的毫秒数
            var minutes = Math.floor(leave2 / (60 * 1000));

            if (days < 1 && hours <= 24) {
                if (hours < 1 && minutes < 60) {
                    data[j].commentTime = minutes + '分钟前';
                } else {
                    data[j].commentTime = hours + '小时前';
                }
            } else {
                data[j].commentTime = item.commentTime.substr(0, 10);
            }
        }
        return data;
    }

    /**
     * 查看销售品的评论
     * @param productsid
     */

    function getComment(productsid) {

        $.ajax({
            url: hostUrl + 'selling/comments/productsComments',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'cpid': CHANNELID,
                'userid': userid,
                'productsid': productsid
            },
            dataType: 'json',
            success: function (result) {
//                console.log("评论");
//                console.log(result);
                if (result.code === 200) {
                    var data = JSON.parse(result.data);

                    if (data && data.length != 0) {
                        //$('#item-success').show();
                        vmplay.commentIsShow = true;
                        vmplay.commentData = computerDataTime(data);
                        if (data.length > 10)   // 评论大于10条才显示置顶评论
                            vmplay.goodComment = true;
                    } else {
                        //$('#item-success').hide();
                        vmplay.commentIsShow = false;
                    }
                } else {
                    //$('#item-success').hide();
                    vmplay.commentIsShow = false;
                }
            },
            error: function () {
                vmplay.commentIsShow = false;
            }
        });
    }

    /**
     * 查看销售品的推广评论
     * @param productsid
     */

    function getRecommendComment(productsid) {

        $.ajax({
            url: hostUrl + 'wx/comments/promoteComments',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'cpid': CHANNELID,
                'userid': userid,
                'productsid': productsid
            },
            dataType: 'json',
            success: function (result) {
                if (result.code === 200) {
                    var data = JSON.parse(result.data);

                    if (data && data.length != 0) {
                        vmplay.recommendcommentData = computerDataTime(data);
                    } else {
                    }
                } else {
                }
            },
            error: function () {
            }
        });
    }

    /**
     * 查看销售品的置顶评论
     * @param productsid
     */

    function getTopComment(productsid) {

        $.ajax({
            url: hostUrl + 'wx/comments/topComments',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'cpid': CHANNELID,
                'userid': userid,
                'productsid': productsid
            },
            dataType: 'json',
            success: function (result) {

                if (result.code === 200) {
                    var data = JSON.parse(result.data);

                    if (data && data.length != 0) {
                        vmplay.topcommentData = computerDataTime(data);
                    } else {
                        vmplay.goodComment = false;
                    }
                } else {
                }
            },
            error: function () {
            }
        });
    }


    /**
     * 单集增加播放量接口
     * @param id
     * @param type 内容类型1视频集 , 3音频集
     * @param contentId
     */
    function addPlayRecord(id, type, contentId) {
        $.ajax({
            url: hostUrl + 'user/center/history/addPlayRecord',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'cpid': CHANNELID,
                'userid': userid,
                'productsid': id,
                'type': type,
                'contentid': contentId
            },
            dataType: 'json',
            success: function (result) {
//                console.log(result);

                if (result.code == 200) {
                } else {
                }
            },
            error: function () {
            }
        });
    }


    //视频集/音频集增加播放量接口 type 内容类型1视频集 , 3音频集
    function addCollection(contentId, type) {
        $.ajax({
            url: hostUrl + 'user/center/history/addCollection',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'contentid': contentId,
                'type': type
            },
            dataType: 'json',
            success: function (result) {
//                console.log(result);
                if (result.code == 200) {
                } else {
                }
            },
            error: function () {
            }
        });
    }

    /**
     *  微信支付
     * @param productsId
     */
    function wxPayConfig(productsId) {
        payType = WXPAY;
        console.log("立即微信支付" + productsId);
        $.ajax({
            url: hostUrl + 'wx/wxConfig',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'url': encodeURIComponent(location.href.split('#')[0])
            },
            dataType: 'json',
            success: function (result) {
                if (result.code == 200) {
                    var data = JSON.parse(result.data);

                    wx.config({
                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                        appId: data.appId, // 必填，公众号的唯一标识
                        timestamp: data.timestamp, // 必填，生成签名的时间戳
                        nonceStr: data.nonceStr, // 必填，生成签名的随机串
                        signature: data.signature, // 必填，签名
                        jsApiList: ['chooseWXPay'] // 必填，需要使用的JS接口列表
                    });


                    chooseWXPay(
                        APPKEY,
                        SIGN,
                        CHANNELID,
                        productsId
                    );
                }
            },
            error: function () {
                alert("发起支付异常，请重试！");

            }
        });
    }

    function chooseWXPay(appKey, sign, cpid, productsId) {

        $.ajax({
            url: hostUrl + 'wx/pay',
            type: 'post',
            data: {
                'appKey': appKey,
                'sign': sign,
                'userid': userid,
                'cpid': cpid,
                'productsId': productsId
            },
            dataType: 'json',
            success: function (result) {
                if (result.code == 200) {
                    var data = JSON.parse(result.data);

                    wx.chooseWXPay({
                        timestamp: data.timestamp, // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符
                        nonceStr: data.nonceStr, // 支付签名随机串，不长于 32 位
                        package: data.packageValue, // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=\*\*\*）
                        signType: data.signType, // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'
                        paySign: data.paySign, // 支付签名
                        success: function (res) {
                            if (res.errMsg == "chooseWXPay:ok") {
                                vmplay.content.hasBuy = true;
                                vmplay.dialogType = 'subSuccess'
//                                alert("支付成功");
                            } else {
                                vmplay.dialogType = 'subFail'
                            }
                        },
                        cancel: function (res) {

                        },
                        fail: function (res) {

                            vmplay.dialogType = 'subFail'
                        },
                        complete: function (res) {

                        }
                    });
                }
            }
        });
    }


    /**
     * 添加评论
     * @param id
     * @param type 1  2  （视频还是音频）
     */
    function addComments(id, type) {
        $("#inputbutton").attr("disabled", "disabled");
        if (vmplay.message == '') {
            alert("请先输入评论内容喔");
            return;
        }
        $.ajax({
            url: hostUrl + 'selling/comments/addComments',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'productsid': id,
                'cpid': CHANNELID,
                'userid': userid,
                'comment': $("#inputcomment").val(),
                'type': type
            },
            dataType: 'json',
            success: function (result) {
                console.log(result);
                if (result.code == 200) {
                    $("#inputbutton").removeAttr("disabled");
                    $("#inputcomment").val('');
                    alert("提交评论成功！审核之后才会显示喔");
                    console.log("200");
                } else {
                    alert("提交评论成失败！请重试");
                    $("#inputbutton").removeAttr("disabled");
                    console.log("err");
                }
            },
            error: function () {
                alert("提交评论失败！请重试");
                $("#inputbutton").removeAttr("disabled");
                return null;
            }
        });
    }

    /**
     * 获取同类推荐的课程
     * @param productsId 产品id
     */
    function getRecommendList(productsId) {
        $.ajax({
            url: hostUrl + 'wx/recommend/products',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'channelCode': CHANNELID,
                'id': productsId,
                'maxCount': 3
            },
            dataType: 'json',
            success: function (result) {
                console.log(result);

                if (result.code == 200) {
                    console.log("200");
                    vmplay.newRecommendData = JSON.parse(result.data);
                    vmplay.newRecisShow = true;
                } else {
                }
            },
            error: function () {
            }
        });
    }

    /**
     * 获取内容
     * @param id 产品id
     */
    function getContent(id) {

        $('html, body').animate({scrollTop: 0}, 'fast');//带动画回到頂部

        $.ajax({
            url: hostUrl + 'wx/products/content',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'productsId': id,
                'userid': userid,
                'cpid': CHANNELID
            },
            dataType: 'json',
            success: function (result) {
                console.log(result);

                if (result.code == 200) {
                    console.log("200");
                    vmplay.isSeen = true;
                    vmplay.content = JSON.parse(result.data);
                    getProductList(id);
                    getRecentUpdate(id)
                } else {
                    console.log("err");
                }
            },
            error: function () {
                return null;
            }
        });
    }


    /**
     * 获取视频集列表
     * @param productsId
     */
    function getProductList(productsId) {
        //    获取列表
        $.ajax({
            url: hostUrl + 'selling/products/productList',
//            url: 'http://192.168.0.129:8080/wycms/selling/products/productList',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'productsId': productsId,
                'userid': userid,
                'cpid': CHANNELID
            },
            dataType: 'json',
            success: function (result) {
                console.log(result);

                if (result.code == 200) {

                    vmplay.categoryData = JSON.parse(result.data);

                    if (!hasInit) {
                        initView();
                        hasInit = true;
                    }

                } else {
                    console.log("err");
                }
            },
            error: function () {
            }
        });
    }

    var hasInit = false;
    /**
     * 获取最近更新
     */
    function getRecentUpdate() {
        //    获取列表
        $.ajax({
            url: hostUrl + 'wx/products/recentUpdate',
//            url: 'http://192.168.0.129:8080/wycms/selling/products/productList',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'channelCode': CHANNELID,
                'productid': productsid
            },
            dataType: 'json',
            success: function (result) {
                console.log(result);

                if (result.code == 200) {
                    vmplay.recentUpdate = JSON.parse(result.data);
                } else {
                    console.log("err");
                }
            },
            error: function () {
            }
        });
    }

    /**
     * 收藏 Or 取消收藏接口
     */
    function doCollect() {

        vmplay.remarkNumIsShow = true;
        setTimeout(" vmplay.remarkNumIsShow = false ;  ", 1500);
        var id = GetQueryString('id');
        //    获取列表
        $.ajax({
            url: hostUrl + 'user/remark/addOrUpdate',
            type: 'post',
            async: true,
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'userid': userid,
                'cpid': CHANNELID,
                'productsid': id
            },

            dataType: 'json',
            success: function (result) {

                if (result.code == 200) {

                    if (vmplay.content.isRemark == 1) {
                        vmplay.content.remarkNum--;
                        vmplay.content.isRemark = 0
                    }
                    else {
                        vmplay.content.remarkNum++;
                        vmplay.content.isRemark = 1
                    }


                } else {
                    console.log("err");
                }
            },
            error: function () {
            }
        });
    }


    /**
     * 验证码倒计时
     * @param obj 当前标签对象
     */
    function invokeSetTime(obj) {
        var countdown = 60;
        settime(obj);
        function settime(obj) {
            if (countdown === 0) {
                $(obj).attr("disabled", false);
                $(obj).text("获取验证码");
                countdown = 60;
                return;
            } else {
                $(obj).attr("disabled", true);
                $(obj).text("(" + countdown + ") s 重发");
                countdown--;
            }
            setTimeout(function () {
                    settime(obj)
                }
                , 1000)
        }
    }

    var phoneNumber, orderId;   // 手机号码和短信验证码订单号
    /**
     * 登录验证
     * @param obj
     * @param type 获取验证码的类型 1 是登录  2 是订购
     */
    function checkPhone(obj) {
        phoneNumber = $('#textPhone').val();

        if (phoneNumber.length === 0) {
            alert('手机号码不能为空！');
            return;
        }
        if (phoneNumber.length !== 11) {
            alert('请输入正确的11位手机号码！');
            return;
        }
        sendVerifyCode(phoneNumber, obj);

//        if (!PATTERN_CHINAUNICOM.test(phoneNumber)) {
//            alert('请输入正确的联通手机号码！');
//            return;
//        }

//            if (hasOrder(phoneNumber)) {
//                localStorage.phoneNum = phoneNumber;
//                alert("您已订购该课程，请换个号码领取喔");
//            }
//            else {
//                sendVerifyCode(phoneNumber, obj);
//
//            }


    }

    /**
     *  3. 话费支付-获取验证码
     * @param phone 手机号码
     * @param obj 标签对象
     */
    function sendVerifyCode(phone, obj) {
        $.ajax({
            url: hostUrl + 'wx/payfee/sendVerifyCode',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'cpid': CHANNELID,
                'productsid': vmplay.content.productsCode,
                'userId': userid,
                'phone': phone
            },
            dataType: 'json',
            success: function (result) {
                console.log(result);
                if (result.code === 200) {
                    var data = JSON.parse(result.data);
                    orderId = data.orderId;
                    localStorage.phoneNum = phone; //储存手机号

                    invokeSetTime(obj)

                } else {
                    alert('获取验证码失败！请稍后重试或换个号码重试');
                    console.log("err");

                }
            },
            error: function () {
            }
        });
    }

    /**
     * 4. 话费支付-回复验证码
     * @param verifyCode 验证码
     * @param orderId 获取验证码返回的订单号
     * @param phoneNumber 手机号
     * result code (-5 不支持该课程 ，   -7   )
     */
    function confirmVerifyCode() {

        if (orderId.length === 0) {
            alert('请先输入手机号获取验证码！');
            return;
        }

        var verifyCode = $('#textSmCode').val();
        if (verifyCode.length === 0) {
            alert('请先输入验证码！');
            return;
        }

        $.ajax({
            url: hostUrl + 'api/payfee/confirmVerifyCode',
            type: 'post',
            data: {
                'appKey': APPKEY,
                'sign': SIGN,
                'verifyCode': verifyCode,
                'orderId': orderId,
                'phone': phoneNumber
            },
            dataType: 'json',
            success: function (result) {
                if (result.code === 200) {
                    // alert('订购成功！');
                    vmplay.dialogType = 'subSuccess';
                    alert('订购成功！');
                    // $('.cd-popup-ima').attr('src', 'images/dialog-order-success.png');
                    // 订购成功 我要去抽奖
                } else {
                    vmplay.dialogType = 'subFail';
                    alert('订购失败！请稍后重试');


                }
            },
            error: function () {
            }
        });
    }
    const WXPAY = 1;
    const FAREPAY = 2;
    var payType;
    /**
     * 切换支付方式
     */
    function changeOtherPay() {
        if (payType === WXPAY) {
            vmplay.dialogType = 'smsSub';
        } else if (payType === FAREPAY) {
            wxPayConfig(vmplay.content.productsCode)
        }
    }

</script>

</body>
</html>